{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="blog-header">
        <h1>All Blog Posts</h1>
        {% if current_user.is_authenticated %}
            <a href="{{ url_for('blog.create') }}" class="btn">Write New Post</a>
        {% endif %}
    </div>
    
    {% if posts.items %}
        {% for post in posts.items %}
            <article class="post-preview">
                <h2><a href="{{ url_for('blog.post', id=post.id) }}">{{ post.title }}</a></h2>
                <p class="post-meta">
                    By {{ post.author.username }} on {{ post.created_at.strftime('%B %d, %Y') }}
                    {% if post.get_all_comments_count() > 0 %}
                        • <a href="{{ url_for('blog.post', id=post.id) }}#comments" class="comment-count">
                            {{ post.get_all_comments_count() }} comment{{ 's' if post.get_all_comments_count() != 1 else '' }}
                        </a>
                    {% endif %}
                    {% if post.get_like_count() > 0 %}
                        • <span class="like-count">
                            ❤️ {{ post.get_like_count() }} like{{ 's' if post.get_like_count() != 1 else '' }}
                        </span>
                    {% endif %}
                </p>
                <p class="post-excerpt">{{ post.content[:200] }}...</p>
                <a href="{{ url_for('blog.post', id=post.id) }}" class="read-more">Read More</a>
            </article>
        {% endfor %}
        
        <!-- Pagination -->
        {% if posts.pages > 1 %}
            <div class="pagination">
                {% if posts.has_prev %}
                    <a href="{{ url_for('blog.index', page=posts.prev_num) }}">&laquo; Previous</a>
                {% endif %}
                
                {% for page_num in posts.iter_pages() %}
                    {% if page_num %}
                        {% if page_num != posts.page %}
                            <a href="{{ url_for('blog.index', page=page_num) }}">{{ page_num }}</a>
                        {% else %}
                            <span class="current">{{ page_num }}</span>
                        {% endif %}
                    {% endif %}
                {% endfor %}
                
                {% if posts.has_next %}
                    <a href="{{ url_for('blog.index', page=posts.next_num) }}">Next &raquo;</a>
                {% endif %}
            </div>
        {% endif %}
    {% else %}
        <p>No blog posts yet. Be the first to write one!</p>
    {% endif %}
</div>
{% endblock %}
