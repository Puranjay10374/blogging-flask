<!-- Individual Comment Template -->
<div class="comment-item" id="comment-{{ comment.id }}">
    <div class="comment-header">
        <div class="comment-author-info">
            <img src="{{ comment.author.avatar }}" alt="{{ comment.author.username }}" class="comment-avatar">
            <div class="comment-meta">
                <strong class="comment-author">{{ comment.author.username }}</strong>
                <span class="comment-date">{{ comment.created_at.strftime('%B %d, %Y at %I:%M %p') }}</span>
                {% if comment.updated_at > comment.created_at %}
                    <span class="comment-edited">(edited)</span>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="comment-content">
        <p>{{ comment.content|replace('\n', '<br>')|safe }}</p>
    </div>
    
    <div class="comment-actions">
        {% if current_user.is_authenticated %}
            <button class="btn btn-link btn-sm reply-btn" data-comment-id="{{ comment.id }}">
                Reply
            </button>
        {% endif %}
        
        {% if current_user == comment.author %}
            <a href="{{ url_for('blog.edit_comment', comment_id=comment.id) }}" class="btn btn-link btn-sm">
                Edit
            </a>
            <form method="POST" action="{{ url_for('blog.delete_comment', comment_id=comment.id) }}" style="display: inline;"
                  onsubmit="return confirm('Are you sure you want to delete this comment?')">
                <input type="submit" value="Delete" class="btn btn-link btn-sm text-danger">
            </form>
        {% endif %}
    </div>
    
    <!-- Nested Replies -->
    {% if comment.get_replies_count() > 0 %}
        <div class="comment-replies">
            {% for reply in comment.get_replies() %}
                <div class="comment-item reply-item" id="comment-{{ reply.id }}">
                    <div class="comment-header">
                        <div class="comment-author-info">
                            <img src="{{ reply.author.avatar }}" alt="{{ reply.author.username }}" class="comment-avatar small">
                            <div class="comment-meta">
                                <strong class="comment-author">{{ reply.author.username }}</strong>
                                <span class="comment-date">{{ reply.created_at.strftime('%B %d, %Y at %I:%M %p') }}</span>
                                {% if reply.updated_at > reply.created_at %}
                                    <span class="comment-edited">(edited)</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="comment-content">
                        <p>{{ reply.content|replace('\n', '<br>')|safe }}</p>
                    </div>
                    
                    <div class="comment-actions">
                        {% if current_user.is_authenticated and reply.get_thread_depth() < 3 %}
                            <button class="btn btn-link btn-sm reply-btn" data-comment-id="{{ reply.id }}">
                                Reply
                            </button>
                        {% endif %}
                        
                        {% if current_user == reply.author %}
                            <a href="{{ url_for('blog.edit_comment', comment_id=reply.id) }}" class="btn btn-link btn-sm">
                                Edit
                            </a>
                            <form method="POST" action="{{ url_for('blog.delete_comment', comment_id=reply.id) }}" style="display: inline;"
                                  onsubmit="return confirm('Are you sure you want to delete this reply?')">
                                <input type="submit" value="Delete" class="btn btn-link btn-sm text-danger">
                            </form>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}
</div>
